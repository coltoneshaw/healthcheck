# Start from the kjarosh/latex:2023.1-basic base image
FROM kjarosh/latex:2023.1-basic

# Add the "community" repository to /etc/apk/repositories
RUN echo "http://dl-cdn.alpinelinux.org/alpine/edge/community" >> /etc/apk/repositories

# Update apk and install Pandoc
RUN apk update && apk add pandoc

RUN mkdir -p /usr/share/fonts/truetype/

# Download and install the Symbola font
RUN wget https://dn-works.com/wp-content/uploads/2020/UFAS-Fonts/Symbola.zip \
    && unzip Symbola.zip -d /usr/share/fonts/truetype/ \
    && fc-cache -f -v

# Update tlmgr and install tabularray
RUN tlmgr update --self && tlmgr install tabularray etoolbox xcolor ninecolors fontspec luatex soul

# Add Maintainer Info
LABEL maintainer="colton.shaw@mattermost.com"
LABEL org.opencontainers.image.title="mmhealth"
LABEL org.opencontainers.image.description="Mattermost Healthcheck Image"
LABEL org.opencontainers.image.authors="Colton Shaw"
LABEL org.opencontainers.image.source="https://github.com/coltoneshaw/mmhealth"
LABEL org.opencontainers.image.licenses=MIT

RUN mkdir /files

# Set the Current Working Directory inside the container
WORKDIR /app

COPY ./template/template.tex .
COPY ./template/*.png .

ENV TEXMFVAR /tmp/texmf-var
RUN mkdir -p /tmp/texmf-var
RUN chmod -R 777 /tmp/texmf-var

ENTRYPOINT ["pandoc", "--pdf-engine=lualatex"]